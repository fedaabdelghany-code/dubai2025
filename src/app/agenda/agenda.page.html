<ion-content [fullscreen]="true" class="agenda-content">
  <div class="pb-20">
    <!-- Header -->
    <div class="header-gradient">
      <h2 class="header-title">SCHEDULE</h2>
      <img src="assets/skyline.webp" alt="" class="header-overlay" />

      <!-- Search Bar -->
      <div class="search-container">
        <ion-icon name="search-outline" class="search-icon"></ion-icon>
        <input
          type="text"
          placeholder="Search..."
          class="search-input"
          [(ngModel)]="searchQuery"
          (input)="onSearchChange(searchQuery)"
        />
        <button
          *ngIf="searchQuery"
          class="clear-search-btn"
          (click)="clearSearch()"
        >
          <ion-icon name="close-circle"></ion-icon>
        </button>
      </div>
    </div>

    <!-- Day Selector -->
    <div class="tabs-container">
      <div class="tabs-wrapper">
        <button
          *ngFor="let day of ['1', '2', '3']"
          class="tab-btn"
          [class.active]="selectedDay === day"
          (click)="setSelectedDay(day)"
        >
          Day {{ day }}
        </button>
      </div>
    </div>

    <!-- Sessions List -->
<div class="sessions-container" [class.transitioning]="isTransitioning">
      <ng-container *ngIf="filteredSessions.length > 0; else noSessions">
        <div
          *ngFor="let session of filteredSessions; let i = index"
          class="session-card"
          [id]="session.id ?? ('session-' + i)"
          [style.border-left-color]="session.color"
        >
          <!-- Session Time Badge -->
          <div class="time-badge" [style.background-color]="session.color">
            <ion-icon name="time-outline" class="time-icon"></ion-icon>
            {{ session.startTime.toDate() | date: 'shortTime' }}
          </div>

          <!-- Session Content -->
          <div class="session-content">
            <!-- Category Tag -->
            <div class="session-tags">
              <span
                class="category-tag"
                [style.background-color]="session.color + '20'"
                [style.color]="session.color"
              >
                {{ formatCategory(session.category) }}
              </span>
            </div>

            <!-- Title -->
            <h3 class="session-title">{{ session.title }}</h3>

            <!-- Speaker Info -->
            <div
              class="speaker-info"
              *ngIf="session.speaker?.name && session.speaker?.name?.toLowerCase() !== 'all'"
            >
              <div
                class="speaker-avatar"
                *ngIf="!session.speaker?.photoURL || session.speaker?.photoURL === 'null'"
              >
                {{
                  session.speaker?.name?.[0] ||
                  ''
                }}{{
                  (session.speaker?.name?.split(' ')?.[1] || '')?.[0] || ''
                }}
              </div>
              <img
                *ngIf="session.speaker?.photoURL && session.speaker?.photoURL !== 'null'"
                [src]="session.speaker?.photoURL"
                alt="{{ session.speaker?.name }}"
                class="speaker-avatar-img"
              />
              <div class="speaker-details">
                <div class="speaker-name clickable">
                  {{ session.speaker?.name }}
                </div>
                <div class="speaker-role">
                  {{ session.speaker?.title }}
                </div>
              </div>
            </div>

            <!-- Session Meta Info -->
            <div class="session-meta sleek">
              <div class="meta-item">
                <ion-icon name="time-outline" class="meta-icon"></ion-icon>
                <span class="meta-value">{{ formatSessionTime(session) }}</span>
              </div>
              <div
                class="meta-item clickable"
              >
                <ion-icon name="location-outline" class="meta-icon"></ion-icon>
                <span class="meta-value">{{ session.location }}</span>
              </div>
            </div>

            <!-- Materials Section -->
            <div class="materials-section" *ngIf="hasMaterial(session)">
              <div class="materials-header">
                <div class="materials-title">
                  <ion-icon
                    name="folder-outline"
                    class="folder-icon"
                  ></ion-icon>
                  <span>Attachment</span>
                </div>
              </div>

              <div class="materials-grid">
                <a
                  class="material-card"
                  [href]="session.material"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <div
                    class="material-icon-wrapper"
                    [style.background-color]="session.color + '15'"
                  >
                    <ion-icon
                      [name]="getMaterialIcon(getMaterialType(session.material!))"
                      class="material-icon"
                      [style.color]="session.color"
                    ></ion-icon>
                  </div>

                  <div class="material-info">
                    <div class="material-name">{{ session.title }}</div>
                    <div class="material-meta">
                      <span class="material-type">
                        {{ getMaterialType(session.material!) }}
                      </span>
                    </div>
                  </div>

                  <div class="material-download-btn" [style.color]="session.color">
                    <ion-icon name="open-outline"></ion-icon>
                  </div>
                </a>
              </div>
            </div>

            <!-- Q&A Section -->
            <div class="materials-section" *ngIf="session.qnaLink">
              <div class="materials-header">
                <div class="materials-title">
                  <ion-icon
                    name="chatbubble-outline"
                    class="folder-icon"
                  ></ion-icon>
                  <span>Have a question for this session?</span>
                </div>
              </div>

              <div class="materials-grid">
                <a
                  class="material-card"
                  [href]="session.qnaLink"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <div
                    class="material-icon-wrapper"
                    style="background-color: #7ab02315"
                  >
                    <ion-icon
                      name="chatbubble-ellipses-outline"
                      class="material-icon"
                      style="color: #7ab023"
                    ></ion-icon>
                  </div>

                  <div class="material-info">
                    <div class="material-name" style="font-weight: 300;">
                      Submit your question!
                    </div>
                  </div>

                  <div class="material-download-btn" style="color: #7ab023">
                    <ion-icon name="open-outline"></ion-icon>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- No Sessions -->
      <ng-template #noSessions>
        <div class="no-sessions">
          <div class="no-sessions-icon">
            <ion-icon name="calendar-clear-outline"></ion-icon>
          </div>
          <h3 class="no-sessions-title">
            {{ searchQuery ? 'No Results Found' : 'No Sessions Scheduled' }}
          </h3>
          <p class="no-sessions-text">
            <ng-container *ngIf="searchQuery; else noSearchMessage">
              No sessions match your search "{{ searchQuery }}".<br />
              Try different keywords or
              <button
                class="inline-clear-btn"
                (click)="clearSearch()"
              >
                clear your search
              </button>.
            </ng-container>
            <ng-template #noSearchMessage>
              There are no sessions scheduled for Day {{ selectedDay }}.<br />
              Check other days or come back later for updates!
            </ng-template>
          </p>
        </div>
      </ng-template>
    </div>
  </div>
</ion-content>

