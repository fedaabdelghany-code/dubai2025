<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="closeModal()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>New Post</ion-title>
    <ion-buttons slot="end">
      <ion-button 
        [disabled]="!canPost() || isLoading" 
        (click)="createPost()"
        [strong]="true">
        Post
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- User Info -->
  <div class="user-info">
    <ion-avatar>
      <img 
        [src]="userPhoto" 
        [alt]="userName"
        (error)="onImageError($event)" />
    </ion-avatar>
    <div class="user-details">
      <h3>{{ userName }}</h3>
    </div>
  </div>

  <!-- Caption Input -->
  <ion-textarea
    [(ngModel)]="caption"
    placeholder="What's on your mind?"
    rows="4"
    autoGrow="true"
    class="caption-input">
  </ion-textarea>

  <!-- Image Preview -->
  <div *ngIf="selectedImageDataUrl" class="image-preview">
    <img [src]="selectedImageDataUrl" alt="Selected image" />
    <ion-button 
      fill="clear" 
      class="remove-image-btn"
      (click)="removePhoto()">
      <ion-icon name="close-circle" slot="icon-only"></ion-icon>
    </ion-button>
  </div>

  <!-- Add Photo Buttons -->
  <div class="photo-actions">
    <!-- Mobile: Camera/Gallery Action Sheet -->
    <ion-button 
      *ngIf="!selectedImageDataUrl"
      expand="block" 
      fill="outline"
      (click)="selectImageSource()"
      class="add-photo-btn">
      <ion-icon name="camera" slot="start"></ion-icon>
      Add Photo
    </ion-button>

    <!-- Web Fallback: Hidden File Input -->
    <input 
      type="file" 
      id="photoUpload" 
      accept="image/*" 
      (change)="onPhotoSelected($event)"
      style="display: none;" />
  </div>
</ion-content>