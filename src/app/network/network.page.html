<ion-content [fullscreen]="true" class="network-content">

  <!-- HEADER -->
  <div class="header-gradient">
    <h2 class="header-title">NETWORK</h2>
    <img src="assets/skyline.webp" alt="" class="header-overlay" />

    <!-- SEARCH BAR -->
    <div class="search-container">
      <ion-icon name="search-outline" class="search-icon"></ion-icon>
      <input
        type="text"
        placeholder="Search posts or people..."
        class="search-input"
        [(ngModel)]="searchQuery"
        (input)="onSearchChange(searchQuery)"
      />
    </div>
  </div>

  <!-- FEED CONTAINER -->
  <div class="feed-container">

    <!-- SKELETON LOADER - Show while loading -->
    <div *ngIf="isLoading" class="skeleton-container">
      <div *ngFor="let item of [1, 2, 3]" class="post-card skeleton-post">
        <!-- Post Header Skeleton -->
        <div class="post-header">
          <ion-skeleton-text [animated]="true" class="skeleton-avatar"></ion-skeleton-text>
          <div class="post-user-info">
            <ion-skeleton-text [animated]="true" style="width: 40%; height: 16px;"></ion-skeleton-text>
            <ion-skeleton-text [animated]="true" style="width: 60%; height: 12px; margin-top: 4px;"></ion-skeleton-text>
          </div>
        </div>

        <!-- Caption Skeleton -->
        <ion-skeleton-text [animated]="true" style="width: 90%; height: 14px; margin: 12px 0;"></ion-skeleton-text>
        <ion-skeleton-text [animated]="true" style="width: 70%; height: 14px; margin-bottom: 12px;"></ion-skeleton-text>

        <!-- Image Skeleton -->
        <ion-skeleton-text [animated]="true" class="skeleton-image"></ion-skeleton-text>

        <!-- Actions Skeleton -->
        <div class="post-actions">
          <ion-skeleton-text [animated]="true" style="width: 60px; height: 24px;"></ion-skeleton-text>
          <ion-skeleton-text [animated]="true" style="width: 60px; height: 24px;"></ion-skeleton-text>
        </div>
      </div>
    </div>

    <!-- EMPTY STATE - Show when no posts and not loading -->
    <div *ngIf="!isLoading && filteredPosts.length === 0" class="empty-state">
      <ion-icon name="newspaper-outline"></ion-icon>
      <p>No posts yet. Be the first to share!</p>
    </div>

    <!-- POSTS FEED - Show when loaded -->
    <div *ngIf="!isLoading && filteredPosts.length > 0">
<div *ngFor="let post of filteredPosts; trackBy: trackByPostId" class="post-card">
        <div class="post-header">
          <img
            [src]="post.userPhoto || 'assets/default-avatar.png'"
            class="avatar-sm"
            alt="User Photo"
          />
          <div class="post-user-info">
            <h3>{{ post.userName }}</h3>
            <p class="timestamp">{{ post.timestamp?.toDate() | date: 'medium' }}</p>
          </div>
        </div>

        <p class="post-caption">{{ post.caption }}</p>

        <img
          *ngIf="post.photoURL"
          [src]="post.photoURL"
          alt="Post Image"
          class="post-image"
        />

        <div class="post-actions">
          <button (click)="toggleLike(post)">
            <ion-icon [name]="post.liked ? 'heart' : 'heart-outline'" 
                      [class.liked]="post.liked"></ion-icon>
            {{ getLikeCount(post) }}
          </button>

          <button (click)="toggleComments(post)">
            <ion-icon name="chatbubble-outline"></ion-icon>
            {{ getCommentCount(post) }}
          </button>
        </div>

        <!-- COMMENTS SECTION -->
        <div *ngIf="post.showComments" class="comments-section">
          <div *ngFor="let comment of post.comments" class="comment-item">
            <img 
              [src]="comment.userPhoto || 'assets/default-avatar.png'" 
              class="comment-avatar"
              alt="Commenter"
            />
            <div class="comment-content">
              <strong>{{ comment.userName }}</strong>
              <p>{{ comment.text }}</p>
              <span class="comment-time">{{ comment.timestamp?.toDate() | date: 'short' }}</span>
            </div>
          </div>

          <div class="add-comment">
            <img 
              [src]="currentUserPhoto || 'assets/default-avatar.png'" 
              class="comment-avatar"
              alt="You"
            />
            <input
              type="text"
              [(ngModel)]="post.newComment"
              placeholder="Write a comment..."
              (keydown.enter)="addComment(post)"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FAB BUTTON -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openNewPostModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>