<ion-content [fullscreen]="true" [scrollY]="true">
  <div class="home-wrapper">
    <!-- Header -->
    <div class="header-gradient">
      <div class="header-container">
        <div class="header-content">
          <p class="event-label">AMEA STRATEGY 2025</p>
          <h1 class="day-title">Day {{ currentDay }}</h1>
          <p class="date-text">Ahlan, Feda!</p>
        </div>
        <img src="assets/calig.png" alt="" class="header-overlay" />
      </div>
    </div>

    <div class="content-container">
      <!-- Next Session Card -->
  <ng-container *ngIf="nextSession$ | async as session; else noSession">
    <div class="next-session-card">
      <div class="card-content">
        <div class="session-header">
          <div class="next-badge" [style.background]="'#94C12E'">
            NEXT SESSION
          </div>
<div class="time-remaining">
  {{ getTimeUntil(session) }}
</div>
        </div>

        <h3 class="session-title">{{ session.title }}</h3>

        <div class="session-info">
          <div class="info-item">
            <ion-icon name="time-outline" class="info-icon"></ion-icon>
            <span>
              {{ session.startTime.toDate() | date:'shortTime' }} -
              {{ session.endTime.toDate() | date:'shortTime' }}
            </span>
          </div>
          <div class="info-item">
            <ion-icon name="location-outline" class="info-icon"></ion-icon>
            <span>{{ session.location }}</span>
          </div>
        </div>

        <div class="speaker-info" *ngIf="shouldDisplaySpeaker(session)">
          <div class="avatar" *ngIf="session.speaker && (!session.speaker.photoURL || session.speaker.photoURL === 'null')">
            {{ session.speaker.name[0] }}{{ session.speaker.name.split(' ')[1]?.[0] || '' }}
          </div>
          <img *ngIf="session.speaker?.photoURL && session.speaker?.photoURL !== 'null'"
               [src]="session.speaker?.photoURL"
               alt="{{ session.speaker?.name }}"
               class="avatar-img" />
          <div class="speaker-details">
            <div class="speaker-name">{{ session.speaker?.name }}</div>
            <div class="speaker-role">{{ session.speaker?.title }}</div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #noSession>
    <div class="no-session-message" *ngIf="messageType === 'today'">
      <ion-icon name="sparkles-outline" class="fun-icon"></ion-icon>
      <p>You're all caught up for today! üåû  
      Time to grab a coffee, chat, and recharge for tomorrow's sessions.</p>
    </div>

    <div class="no-session-message" *ngIf="messageType === 'over'">
      <ion-icon name="party-popper-outline" class="fun-icon"></ion-icon>
      <p>üéâ That's a wrap!  
      The convention has officially concluded. Thanks for being part of it!</p>
    </div>
  </ng-template>

      <!-- Quick Actions -->
<div class="quick-actions" [class.no-next-session]="!(nextSession$ | async)">
        <div class="action-card qr-card" (click)="openQRCode()">
          <div class="action-content">
            <div class="action-icon qr-icon">
              <ion-icon name="qr-code-outline"></ion-icon>
            </div>
            <div class="action-title">My QR Code</div>
            <div class="action-desc">Share contact</div>
          </div>
        </div>
        
        <div class="action-card venue-card" (click)="navigateToVenue()">
          <div class="action-content">
            <div class="action-icon venue-icon">
              <ion-icon name="map-outline"></ion-icon>
            </div>
            <div class="action-title">Venue Map</div>
            <div class="action-desc">Navigate venue</div>
          </div>
        </div>
      </div>

      <!-- My Agenda -->
      <div class="agenda-card">
        <div class="card-content">
          <div class="card-header">
            <h3 class="card-title">My Agenda</h3>
            <button class="view-all-btn" (click)="navigateToAgenda()">
              View All
            </button>
          </div>
          
<div class="agenda-sessions" *ngIf="todaySessions$ | async as todaySessions">
  <ng-container *ngIf="todaySessions.length; else noSessions">
<div
  class="agenda-item"
  *ngFor="let session of todaySessions; let i = index"
  (click)="goToAgendaSession(session)"
>
  <div class="time-block" [ngClass]="session.color ? 'time-' + session.color : 'time-blue'">
    <div class="time">
      {{ session.startTime.toDate() | date: 'shortTime' }}
    </div>
    <div class="room">{{ session.location }}</div>
  </div>
  <div class="session-details">
    <div class="session-name">{{ session.title }}</div>
    <div class="session-speaker" *ngIf="shouldDisplaySpeaker(session)">
      {{ session.speaker?.name }}
    </div>
  </div>
</div>
  </ng-container>

  <ng-template #noSessions>
    <p class="no-sessions">No sessions scheduled for today.</p>
  </ng-template>
</div>

        </div>
      </div>

<!-- Announcements Card -->
<div class="announcements-card" *ngIf="announcements$ | async as announcements">
  <div class="card-content">
    <div class="card-header">
      <h3 class="card-title">Announcements</h3>
    </div>

    <div class="announcement-list" *ngIf="announcements.length; else noAnnouncements">
      <div class="announcement-item" *ngFor="let a of announcements">
        <div
          class="announcement-dot"
          [class.active]="a.active || a.priority === 'high'"
          [class.pulse]="a.priority === 'high'"
        ></div>

        <div class="announcement-content">
          <div class="announcement-title">{{ a.title }}</div>
          <div class="announcement-desc">{{ a.description }}</div>
          <div class="announcement-time">{{ timeAgo(a.timestamp) }}</div>
        </div>
      </div>
    </div>

    <ng-template #noAnnouncements>
      <div class="no-announcements">
        <ion-icon name="notifications-off-outline" class="fun-icon"></ion-icon>
        <p>No fresh announcements right now üéà<br>
        Relax, explore, and check back soon for updates!</p>
      </div>
    </ng-template>
  </div>
</div>

  <!-- QR Modal -->
  <ion-modal [isOpen]="showQR" [backdropDismiss]="true" (didDismiss)="closeQRCode()" class="qr-modal">
    <ng-template>
      <div class="qr-modal-content">
        <div class="qr-header">
          <h2 class="qr-title">Digital Business Card</h2>
          <button class="close-btn" (click)="closeQRCode()">Close</button>
        </div>

        <div class="qr-container">
          <div class="qr-card-modal">
            <div class="qr-card-content">
              <div class="qr-display">
                <div class="qr-frame">
                  <div class="qr-code">
                    <ion-icon name="qr-code"></ion-icon>
                  </div>
                </div>
                <p class="qr-instruction">Scan to exchange contact information</p>
              </div>
              
              <div class="user-info">
                <div class="info-row">
                  <div class="info-icon">
                    <ion-icon name="person-outline"></ion-icon>
                  </div>
                  <div class="info-text">
                    <div class="info-label">Name</div>
                    <div class="info-value">John Anderson</div>
                  </div>
                </div>
                
                <div class="info-row">
                  <div class="info-icon info-emoji">üíº</div>
                  <div class="info-text">
                    <div class="info-label">Position</div>
                    <div class="info-value">Director of Marketing</div>
                  </div>
                </div>
                
                <div class="info-row">
                  <div class="info-icon info-emoji">üåç</div>
                  <div class="info-text">
                    <div class="info-label">Country</div>
                    <div class="info-value">Egypt</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <button class="scanner-button">
            Switch to Scanner Mode
          </button>
        </div>
      </div>
    </ng-template>
  </ion-modal>

    </div>
  </div>
</ion-content>