<ion-content [fullscreen]="true" [scrollY]="true">
  <div class="home-wrapper">
    <!-- ================= HEADER ================= -->
    <div class="header-gradient">
      <div class="header-container">
        <div class="header-content">
          <p class="event-label">AMEA REGIONAL MEETING 2025</p>
<h1 class="day-title" *ngIf="currentDay > 0">DAY {{ currentDay }}</h1>
<h1 class="day-title" *ngIf="currentDay === 0">COMING SOON</h1>
          <p class="date-text">Ahlan, {{ displayName }}!</p>
        </div>

        <!-- Logout Icon -->
        <ion-button fill="clear" class="logout-btn" (click)="logoutUser()">
          <ion-icon name="log-out-outline"></ion-icon>
        </ion-button>

        <img src="assets/skyline.webp" alt="" class="header-overlay" />
      </div>
    </div>

    <!-- ================= MAIN CONTENT ================= -->
    <div class="content-container">
      <!-- Skeleton Loader -->
      <ng-container *ngIf="primarySession === null && messageType === null; else loadedContent">
        <div class="session-card skeleton-loader">
          <div class="card-content">
            <div class="session-header">
              <div class="skeleton skeleton-badge"></div>
              <div class="skeleton skeleton-time"></div>
            </div>
            <div class="skeleton skeleton-title"></div>
            <div class="session-info">
              <div class="info-item">
                <div class="skeleton skeleton-icon"></div>
                <div class="skeleton skeleton-info-text"></div>
              </div>
              <div class="info-item">
                <div class="skeleton skeleton-icon"></div>
                <div class="skeleton skeleton-info-text"></div>
              </div>
            </div>
            <div class="speaker-info">
              <div class="skeleton skeleton-avatar"></div>
              <div class="speaker-details">
                <div class="skeleton skeleton-speaker-name"></div>
                <div class="skeleton skeleton-speaker-role"></div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- ================= ACTUAL CONTENT ================= -->
      <ng-template #loadedContent>
        <!-- Primary or Upcoming Session -->
        <ng-container *ngIf="primarySession; else noSession">
          <div
            class="session-card"
            [ngClass]="isLive(primarySession) ? 'live' : 'next-session'"
            (click)="goToAgendaSession(primarySession)"
          >
            <div class="card-content">
              <div class="session-header">
                <div
                  class="status-badge"
                  [ngClass]="isLive(primarySession) ? 'live' : 'next'"
                >
                  {{ isLive(primarySession) ? 'LIVE NOW' : 'UP NEXT' }}
                </div>
                <div class="time-remaining" *ngIf="!isLive(primarySession)">
                  {{ getTimeUntil(primarySession) }}
                </div>
              </div>

              <h3 class="session-title">{{ primarySession.title }}</h3>

              <div class="session-info">
                <div class="info-item">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>
                    {{ primarySession.startTime.toDate() | date:'shortTime' }} -
                    {{ primarySession.endTime.toDate() | date:'shortTime' }}
                  </span>
                </div>
                <div class="info-item">
                  <ion-icon name="location-outline"></ion-icon>
                  <span>{{ primarySession.location }}</span>
                </div>
              </div>

              <div class="speaker-info" *ngIf="shouldDisplaySpeaker(primarySession)">
                <div
                  class="avatar"
                  *ngIf="
                    primarySession.speaker &&
                    (!primarySession.speaker.photoURL ||
                      primarySession.speaker.photoURL === 'null')
                  "
                >
                  {{
                    primarySession.speaker.name[0]
                  }}{{ primarySession.speaker.name.split(' ')[1]?.[0] || '' }}
                </div>

                <img
                  *ngIf="
                    primarySession.speaker?.photoURL &&
                    primarySession.speaker?.photoURL !== 'null'
                  "
                  [src]="primarySession.speaker?.photoURL"
                  alt="{{ primarySession.speaker?.name }}"
                  class="avatar-img"
                />

                <div class="speaker-details">
                  <div class="speaker-name">
                    {{ primarySession.speaker?.name }}
                  </div>
                  <div class="speaker-role">
                    {{ primarySession.speaker?.title }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Secondary Upcoming Session -->
          <div
            class="session-card next-session secondary"
            *ngIf="isLive(primarySession) && secondarySession"
            (click)="goToAgendaSession(secondarySession)"
          >
            <div class="card-content">
              <div class="session-header">
                <div class="status-badge next">UP NEXT</div>
                <div class="time-remaining">
                  {{ getTimeUntil(secondarySession) }}
                </div>
              </div>
              <h3 class="session-title">{{ secondarySession.title }}</h3>
              <div class="session-info">
                <div class="info-item">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>
                    {{ secondarySession.startTime.toDate() | date:'shortTime' }} -
                    {{ secondarySession.endTime.toDate() | date:'shortTime' }}
                  </span>
                </div>
                <div class="info-item">
                  <ion-icon name="location-outline"></ion-icon>
                  <span>{{ secondarySession.location }}</span>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- No Session -->
<ng-template #noSession>
  <div class="session-card no-session" [ngClass]="messageType">
    <div class="card-content">
      <div class="no-session-icon">
        <ion-icon
          *ngIf="messageType === 'before'"
          name="hourglass-outline"
        ></ion-icon>
        <ion-icon
          [name]="messageType === 'today' ? 'checkmark-circle' : 'trophy'"
          *ngIf="messageType === 'today' || messageType === 'over'"
        ></ion-icon>
      </div>

      <h3 class="session-title" *ngIf="messageType === 'before'">
        AMEA 2025 Starts Soon
      </h3>
<p class="session-text" *ngIf="messageType === 'before'">
  You’re a bit early! The event kicks off on November 10th. Stay tuned for an amazing experience.
</p>

      <h3 class="session-title" *ngIf="messageType === 'today'">
        All Caught Up for Today
      </h3>
      <h3 class="session-title" *ngIf="messageType === 'over'">
        AMEA 2025 Complete
      </h3>

      <p class="session-text" *ngIf="messageType === 'today'">
        Enjoy some downtime and we’ll see you tomorrow!
      </p>
      <p class="session-text" *ngIf="messageType === 'over'">
        Thank you for being part of our AMEA 2025 strategy. Safe travels home!
      </p>

      <div class="no-session-decoration"></div>
    </div>
  </div>
</ng-template>


        <!-- Quick Actions -->
        <div class="quick-actions">
          <div class="action-card" (click)="openQRCode()">
            <div class="action-content">
              <div class="action-icon qr"><ion-icon name="qr-code-outline"></ion-icon></div>
              <div class="action-title">My QR</div>
              <div class="action-desc">Share contact</div>
            </div>
          </div>

          <div class="action-card" (click)="openPhotos()">
            <div class="action-content">
              <div class="action-icon photos"><ion-icon name="images-outline"></ion-icon></div>
              <div class="action-title">Photos</div>
              <div class="action-desc">Event gallery</div>
            </div>
          </div>

          <div class="action-card" (click)="navigateToVenue()">
            <div class="action-content">
              <div class="action-icon venue"><ion-icon name="map-outline"></ion-icon></div>
              <div class="action-title">Venue</div>
              <div class="action-desc">Navigate</div>
            </div>
          </div>

          <div class="action-card" (click)="openTips()">
            <div class="action-content">
              <div class="action-icon networking"><ion-icon name="bulb-outline"></ion-icon></div>
              <div class="action-title">Tips</div>
              <div class="action-desc">Recommendations</div>
            </div>
          </div>

          <div class="action-card" (click)="openHSEInduction()">
            <div class="action-content">
              <div class="action-icon hse"><ion-icon name="shield-checkmark-outline"></ion-icon></div>
              <div class="action-title">HSE Induction</div>
              <div class="action-desc">Safety briefing</div>
            </div>
          </div>
        </div>

        <!-- My Agenda -->
        <div class="agenda-card">
          <div class="card-content">
            <div class="card-header">
              <h3 class="card-title">My Agenda</h3>
              <button class="view-all-btn" (click)="navigateToAgenda()">View All</button>
            </div>

            <div class="agenda-sessions" *ngIf="todaySessions$ | async as todaySessions">
              <ng-container *ngIf="todaySessions.length; else noSessions">
                <div
                  class="agenda-item"
                  *ngFor="let session of todaySessions"
                  (click)="goToAgendaSession(session)"
                >
                  <div class="time-block">
                    <div class="time-label">
                      {{ session.startTime.toDate() | date:'shortTime' }}
                    </div>
                  </div>
                  <div class="session-details">
                    <div class="session-name">{{ session.title }}</div>
                  </div>
                </div>
              </ng-container>

              <ng-template #noSessions>
                <div class="empty-state">
                  <div class="empty-icon">
                    <ion-icon name="calendar-outline"></ion-icon>
                  </div>
                  <h4 class="empty-title">No Sessions Today</h4>
                  <p class="empty-text">
                    Free time! Relax or visit the
                    <a [routerLink]="['/tabs/resources']" class="deeplink-text">Resources tab</a>
                    for things to do in Dubai.
                  </p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Announcements -->
<div class="announcements-card" *ngIf="announcements$ | async as announcements">
  <div class="card-content">
    <!-- Title and Add Button on Same Row -->
    <div class="card-header">
      <h3 class="card-title">Announcements</h3>
      <ion-button *ngIf="isAdmin" shape="round" class="add-btn" (click)="openAddModal()">
        <ion-icon name="add-outline"></ion-icon>
      </ion-button>
    </div>

    <!-- Announcements List -->
    <div class="announcement-list" *ngIf="announcements.length; else noAnnouncements">
      <div class="announcement-item" *ngFor="let a of announcements | slice:0:3">
        <div
          class="announcement-dot"
          [class.active]="a.active || a.priority === 'high'"
          [class.pulse]="a.priority === 'high'"
        ></div>
        <div class="announcement-content">
          <div class="announcement-title">{{ a.title }}</div>
          <div class="announcement-desc">{{ a.description }}</div>
          <div class="announcement-time">{{ timeAgo(a.timestamp) }}</div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <ng-template #noAnnouncements>
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="notifications-off-outline"></ion-icon>
        </div>
        <h4 class="empty-title">All Quiet Here</h4>
        <p class="empty-text">
          No fresh announcements right now. Relax, explore, and check back soon!
        </p>
      </div>
    </ng-template>
  </div>
</div><!-- Hotel Wi-Fi Details -->
<div class="hotel-card subtle-highlight">
  <div class="card-content">
    <div class="card-header">
      <div class="card-title-with-icon">
        <h3 class="card-title">Hotel Wi-Fi Details</h3>
      </div>
    </div>
    <div class="wifi-details">
      <p>
        <ion-icon name="radio-outline"></ion-icon>
        <strong>Network:</strong> HolcimGuest
      </p>
      <p>
        <ion-icon name="key-outline"></ion-icon>
        <strong>Password:</strong> Welcome2025!
      </p>
    </div>
  </div>
</div>
      </ng-template>
    </div>


  </div>


<!-- ================= QR MODAL ================= -->
<ion-modal
  [isOpen]="showQR"
  (didDismiss)="closeQRCode()"
  [backdropDismiss]="true"
  class="qr-modal"
>
  <ng-template>
    <div class="qr-modal-content">
      <div class="qr-header">
        <h1 class="qr-title">Digital Business Card</h1>
        <button class="close-btn" (click)="closeQRCode()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <div class="qr-card-modal">
        <div class="qr-card-content">
          <div class="qr-display">
            <div class="qr-frame">
              <img src="assets/qr.png" alt="QR Code" class="qr-image" />
            </div>
            <p class="qr-instruction">Scan to exchange contact information</p>
          </div>

          <div class="user-info">
            <div class="info-row info-row-primary">
              <div class="info-icon">
                <ion-icon name="person-outline"></ion-icon>
              </div>
              <div class="info-text">
                <div class="info-label">Name</div>
                <div class="info-value">Feda Khalid</div>
              </div>
            </div>

            <div class="info-row">
              <div class="info-icon">
                <ion-icon name="briefcase-outline"></ion-icon>
              </div>
              <div class="info-text">
                <div class="info-label">Position</div>
                <div class="info-value">Digital Strategy Specialist</div>
              </div>
            </div>

            <div class="info-row">
              <div class="info-icon">
                <ion-icon name="globe-outline"></ion-icon>
              </div>
              <div class="info-text">
                <div class="info-label">Country</div>
                <div class="info-value">Egypt</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</ion-modal>

    <!-- Add Announcement Modal -->
<!-- ================= ADD ANNOUNCEMENT MODAL ================= -->
<ion-modal
  [isOpen]="showAddModal"
  (willDismiss)="closeAddModal()"
  [backdropDismiss]="true"
  class="add-modal"
>
  <ng-template>
    <div class="add-modal-content">
      <!-- Header -->
      <div class="modal-header">
        <h1 class="modal-title">Add New Announcement</h1>
        <button class="close-btn" (click)="closeAddModal()">
          <ion-icon name="close-outline"></ion-icon>
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <ion-input
          label-placement="floating"
          fill="outline"
          [(ngModel)]="newAnnouncementTitle"
          placeholder="Enter announcement title"
        ></ion-input>

        <ion-textarea
          label="Description"
          label-placement="floating"
          fill="outline"
          [(ngModel)]="newAnnouncementDesc"
          placeholder="Write the announcement details..."
        ></ion-textarea>

        <ion-button
          expand="block"
          shape="round"
          class="save-btn"
          (click)="submitAnnouncement()"
        >
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <span>Post Announcement</span>
        </ion-button>
      </div>
    </div>
  </ng-template>
</ion-modal>

</ion-content>
