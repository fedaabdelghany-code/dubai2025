<ion-content [fullscreen]="true" [scrollY]="true">
  <div class="home-wrapper">
    <!-- Header -->
    <div class="header-gradient">
      <div class="header-container">
        <div class="header-content">
          <p class="event-label">AMEA REGIONAL MEETING 2025</p>
          <h1 class="day-title">DAY {{ currentDay }}</h1>
          <p class="date-text">AHLAN, FEDA!</p>
        </div>

            <!-- Logout Icon (top-right corner) -->
    <ion-button fill="clear" class="logout-btn" (click)="logoutUser()">
      <ion-icon name="log-out-outline"></ion-icon>
    </ion-button>

        <img src="assets/calig.png" alt="" class="header-overlay" />
      </div>
    </div>

    <div class="content-container">
      <!-- Current or Upcoming Session -->
      <ng-container *ngIf="primarySession; else noSession">
        <div
          class="session-card"
          [ngClass]="isLive(primarySession) ? 'live' : 'next-session'"
          (click)="goToAgendaSession(primarySession)"
        >
          <div class="card-content">
            <div class="session-header">
              <div
                class="status-badge"
                [ngClass]="isLive(primarySession) ? 'live' : 'next'"
              >
                {{ isLive(primarySession) ? 'LIVE NOW' : 'UP NEXT' }}
              </div>
              <div class="time-remaining" *ngIf="!isLive(primarySession)">
                {{ getTimeUntil(primarySession) }}
              </div>
            </div>

            <h3 class="session-title">{{ primarySession.title }}</h3>

            <div class="session-info">
              <div class="info-item">
<ion-icon name="time-outline" style="font-size: 0.9rem"></ion-icon>
                <span>
                  {{ primarySession.startTime.toDate() | date: 'shortTime' }} -
                  {{ primarySession.endTime.toDate() | date: 'shortTime' }}
                </span>
              </div>
              <div class="info-item">
<ion-icon name="location-outline" style="font-size: 0.9rem"></ion-icon>
                <span>{{ primarySession.location }}</span>
              </div>
            </div>

            <div
              class="speaker-info"
              *ngIf="shouldDisplaySpeaker(primarySession)"
            >
              <div
                class="avatar"
                *ngIf="
                  primarySession.speaker &&
                  (!primarySession.speaker.photoURL ||
                    primarySession.speaker.photoURL === 'null')
                "
              >
                {{
                  primarySession.speaker.name[0]
                }}{{ primarySession.speaker.name.split(' ')[1]?.[0] || '' }}
              </div>

              <img
                *ngIf="
                  primarySession.speaker?.photoURL &&
                  primarySession.speaker?.photoURL !== 'null'
                "
                [src]="primarySession.speaker?.photoURL"
                alt="{{ primarySession.speaker?.name }}"
                class="avatar-img"
              />

              <div class="speaker-details">
                <div class="speaker-name">
                  {{ primarySession.speaker?.name }}
                </div>
                <div class="speaker-role">
                  {{ primarySession.speaker?.title }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Secondary Upcoming Session -->
        <div
          class="session-card next-session secondary"
          *ngIf="isLive(primarySession) && secondarySession"
          (click)="goToAgendaSession(secondarySession)"
        >
          <div class="card-content">
            <div class="session-header">
              <div class="status-badge next">UP NEXT</div>
              <div class="time-remaining">
                {{ getTimeUntil(secondarySession) }}
              </div>
            </div>

            <h3 class="session-title">{{ secondarySession.title }}</h3>

            <div class="session-info">
              <div class="info-item">
<ion-icon name="time-outline" style="font-size: 0.9rem"></ion-icon>
                <span>
                  {{
                    secondarySession.startTime.toDate() | date: 'shortTime'
                  }}
                  -
                  {{ secondarySession.endTime.toDate() | date: 'shortTime' }}
                </span>
              </div>
              <div class="info-item">
<ion-icon name="location-outline" style="font-size: 0.9rem"></ion-icon>
                <span>{{ secondarySession.location }}</span>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- No Session Message -->
      <ng-template #noSession>
        <div class="session-card no-session" [ngClass]="messageType">
          <div class="card-content">

            <h3 class="session-title" *ngIf="messageType === 'today'">
              All Caught Up for Today
            </h3>
            <h3 class="session-title" *ngIf="messageType === 'over'">
              AMEA 2025 Complete
            </h3>

            <p class="session-text" *ngIf="messageType === 'today'">
              You've completed all of today's sessions. Enjoy some downtime and
              we'll see you tomorrow!
            </p>
            <p class="session-text" *ngIf="messageType === 'over'">
              Thank you for being part of our AMEA 2025 strategy. Your
              participation has been invaluable. Safe travels home!
            </p>
          </div>
        </div>
      </ng-template>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <div class="action-card" (click)="openQRCode()">
          <div class="action-content">
            <div class="action-icon qr">
              <ion-icon name="qr-code-outline"></ion-icon>
            </div>
            <div class="action-title">My QR</div>
            <div class="action-desc">Share contact</div>
          </div>
        </div>

        <div class="action-card" (click)="openPhotos()">
          <div class="action-content">
            <div class="action-icon photos">
              <ion-icon name="images-outline"></ion-icon>
            </div>
            <div class="action-title">Photos</div>
            <div class="action-desc">Event gallery</div>
          </div>
        </div>

        <div class="action-card" (click)="navigateToVenue()">
          <div class="action-content">
            <div class="action-icon venue">
              <ion-icon name="map-outline"></ion-icon>
            </div>
            <div class="action-title">Venue</div>
            <div class="action-desc">Navigate</div>
          </div>
        </div>

        <div class="action-card" (click)="openNetworking()">
          <div class="action-content">
            <div class="action-icon networking">
              <ion-icon name="people-outline"></ion-icon>
            </div>
            <div class="action-title">Network</div>
            <div class="action-desc">Connect</div>
          </div>
        </div>

        <div class="action-card" (click)="openHSEInduction()">
  <div class="action-content">
    <div class="action-icon hse">
      <ion-icon name="shield-checkmark-outline"></ion-icon>
    </div>
    <div class="action-title">HSE Induction</div>
    <div class="action-desc">Safety briefing</div>
  </div>
</div>

      </div>

      <!-- My Agenda -->
      <div class="agenda-card">
        <div class="card-content">
          <div class="card-header">
            <h3 class="card-title">My Agenda</h3>
            <button class="view-all-btn" (click)="navigateToAgenda()">
              View All
            </button>
          </div>

          <div
            class="agenda-sessions"
            *ngIf="todaySessions$ | async as todaySessions"
          >
            <ng-container *ngIf="todaySessions.length; else noSessions">
              <div
                class="agenda-item"
                *ngFor="let session of todaySessions"
                (click)="goToAgendaSession(session)"
              >
                <div
                  class="time-block"
                >
                  <div class="time-label">
                    {{ session.startTime.toDate() | date: 'shortTime' }}
                  </div>
                  <!-- <div class="room">{{ session.location }}</div> -->
                </div>
                <div class="session-details">
                  <div class="session-name">{{ session.title }}</div>
                </div>
              </div>
            </ng-container>

            <ng-template #noSessions>
              <div class="empty-state">
                <div class="empty-icon">
                  <ion-icon name="calendar-outline"></ion-icon>
                </div>
                <h4 class="empty-title">No Sessions Today</h4>
                <p class="empty-text">
                  Free time! Relax or visit the
                  <a
                    [routerLink]="['/tabs/resources']"
                    class="deeplink-text"
                    >Resources tab</a
                  >
                  for things to do in Dubai.
                </p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Announcements -->
      <div
        class="announcements-card"
        *ngIf="announcements$ | async as announcements"
      >
        <div class="card-content">
          <div class="card-header">
            <h3 class="card-title">Announcements</h3>
          </div>

          <div
            class="announcement-list"
            *ngIf="announcements.length; else noAnnouncements"
          >
            <div class="announcement-item" *ngFor="let a of announcements">
              <div
                class="announcement-dot"
                [class.active]="a.active || a.priority === 'high'"
                [class.pulse]="a.priority === 'high'"
              ></div>
              <div class="announcement-content">
                <div class="announcement-title">{{ a.title }}</div>
                <div class="announcement-desc">{{ a.description }}</div>
                <div class="announcement-time">{{ timeAgo(a.timestamp) }}</div>
              </div>
            </div>
          </div>

          <ng-template #noAnnouncements>
            <div class="empty-state">
              <div class="empty-icon">
                <ion-icon name="notifications-off-outline"></ion-icon>
              </div>
              <h4 class="empty-title">All Quiet Here</h4>
              <p class="empty-text">
                No fresh announcements right now. Relax, explore, and check back
                soon!
              </p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Modal -->
  <ion-modal
    [isOpen]="showQR"
    [backdropDismiss]="true"
    (didDismiss)="closeQRCode()"
    class="qr-modal"
  >
    <ng-template>
      <div class="qr-modal-content">
        <div class="qr-header">
          <div class="qr-title-group">
            <h1 class="qr-title">Digital Business Card</h1>
          </div>

          <button class="close-btn" (click)="closeQRCode()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <div class="qr-container">
          <div class="qr-card-modal">
            <div class="qr-card-content">
              <div class="qr-display">
                <div class="qr-frame">
                  <div class="qr-code">
                    <ion-icon name="qr-code"></ion-icon>
                  </div>
                </div>
                <p class="qr-instruction">
                  Scan to exchange contact information
                </p>
              </div>

              <div class="user-info">
                <div class="info-row info-row-primary">
                  <div class="info-icon">
                    <ion-icon name="person-outline"></ion-icon>
                  </div>
                  <div class="info-text">
                    <div class="info-label">Name</div>
                    <div class="info-value">John Anderson</div>
                  </div>
                </div>

                <div class="info-row">
                  <div class="info-icon">
                    <ion-icon name="briefcase-outline"></ion-icon>
                  </div>
                  <div class="info-text">
                    <div class="info-label">Position</div>
                    <div class="info-value">Director of Marketing</div>
                  </div>
                </div>

                <div class="info-row">
                  <div class="info-icon">
                    <ion-icon name="globe-outline"></ion-icon>
                  </div>
                  <div class="info-text">
                    <div class="info-label">Country</div>
                    <div class="info-value">Egypt</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </ion-modal>
</ion-content>
